local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- GUI رئيسي
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LanguageSelector"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local langFrame = Instance.new("Frame", screenGui)
langFrame.Size = UDim2.new(0, 220, 0, 140)
langFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
langFrame.AnchorPoint = Vector2.new(0.5, 0.5)
langFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
langFrame.BorderSizePixel = 0
Instance.new("UICorner", langFrame)

local function createButton(parent, text, posY)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0.8, 0, 0, 50)
    btn.Position = UDim2.new(0.1, 0, 0, posY)
    btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 20
    btn.Text = text
    btn.AutoButtonColor = true
    Instance.new("UICorner", btn)
    return btn
end

local arabicBtn = createButton(langFrame, "عربي", 10)
local englishBtn = createButton(langFrame, "English", 70)

local function startGUI(language)
    langFrame:Destroy()

    local texts = {
        title = language == "ar" and "BQZ_مطور سكربت سامي" or "PhantomX\nScript by: Yaseen",
        setPos = language == "ar" and "تحديد الموقع" or "Set Location",
        gotoPos = language == "ar" and "تنقل للموقع" or "Teleport to Location",
        speed = language == "ar" and "السرعة" or "Speed",
        up = language == "ar" and "تنقل فوق الماب" or "Teleport above map",
        tpEnemy = language == "ar" and "الانتقال للخصم" or "Teleport to Enemy",
        close = "×"
    }

    local successMsg = Instance.new("TextLabel")
    successMsg.Size = UDim2.new(0, 250, 0, 50)
    successMsg.Position = UDim2.new(0, -260, 1, -60)
    successMsg.AnchorPoint = Vector2.new(0, 1)
    successMsg.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    successMsg.BackgroundTransparency = 0.3
    successMsg.TextColor3 = Color3.fromRGB(255, 255, 255)
    successMsg.Font = Enum.Font.GothamBold
    successMsg.TextSize = 16
    successMsg.Text = language == "ar" and "✅ تم تشغيل السكربت بنجاح" or "✅ Script started successfully"
    successMsg.Parent = screenGui
    Instance.new("UICorner", successMsg)
    TweenService:Create(successMsg, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {
        Position = UDim2.new(1, -260, 1, -60)
    }):Play()
    task.delay(5, function() successMsg:Destroy() end)

    local Frame = Instance.new("Frame", screenGui)
    Frame.Size = UDim2.new(0, 220, 0, 350)
    Frame.Position = UDim2.new(-0.5, 0, 0.3, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Frame.Active = true
    Frame.Draggable = true
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)
    Instance.new("UIStroke", Frame).Color = Color3.fromRGB(0, 170, 255)
    TweenService:Create(Frame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
        Position = UDim2.new(0, 20, 0.3, 0)
    }):Play()

    local function createLabel(text, y)
        local lbl = Instance.new("TextLabel", Frame)
        lbl.Size = UDim2.new(1, 0, 0, 50)  -- ارتفاع أكبر للسطرين
        lbl.Position = UDim2.new(0, 0, 0, y)
        lbl.Text = text
        lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
        lbl.BackgroundTransparency = 1
        lbl.Font = Enum.Font.GothamBold
        lbl.TextSize = 16
        lbl.TextYAlignment = Enum.TextYAlignment.Top
        lbl.TextWrapped = true
        return lbl
    end

    local function createButton(text, y)
        local btn = Instance.new("TextButton", Frame)
        btn.Size = UDim2.new(1, -20, 0, 40)
        btn.Position = UDim2.new(0, 10, 0, y)
        btn.Text = text
        btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 14
        Instance.new("UICorner", btn)
        return btn
    end

    createLabel(texts.title, 0)

    local lastPos = nil
    local btnSet = createButton(texts.setPos, 40)
    btnSet.MouseButton1Click:Connect(function()
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then lastPos = hrp.CFrame end
    end)

    local btnGoto = createButton(texts.gotoPos, 90)
    btnGoto.MouseButton1Click:Connect(function()
        local character = player.Character
        if character and lastPos then
            local hrp = character:FindFirstChild("HumanoidRootPart")
            local hum = character:FindFirstChild("Humanoid")
            if hrp and hum then
                hum.PlatformStand = true
                local startPos = hrp.Position
                local endPos = lastPos.Position
                local steps = 30
                for i = 1, steps do
                    local alpha = i / steps
                    local interpPos = startPos:Lerp(endPos, alpha)
                    hrp.CFrame = CFrame.new(interpPos)
                    task.wait(0.03)
                end
                hrp.CFrame = lastPos
                task.wait(0.1)
                hum.PlatformStand = false
            end
        end
    end)

    local inputBox = Instance.new("TextBox", Frame)
    inputBox.PlaceholderText = language == "ar" and "اكتب السرعة هنا (1-10)" or "Enter speed here (1-10)"
    inputBox.Size = UDim2.new(1, -20, 0, 30)
    inputBox.Position = UDim2.new(0, 10, 0, 140)
    inputBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    inputBox.TextColor3 = Color3.fromRGB(0, 0, 0)
    inputBox.Font = Enum.Font.Gotham
    inputBox.TextSize = 14
    inputBox.ClearTextOnFocus = false
    Instance.new("UICorner", inputBox)

    local speedActive = false
    local speedLevel = 1
    local conn
    local btnSpeed = createButton(texts.speed, 180)
    btnSpeed.MouseButton1Click:Connect(function()
        speedActive = not speedActive
        btnSpeed.Text = speedActive and (language == "ar" and "السرعة: ON" or "Speed: ON") or texts.speed

        if speedActive then
            local input = tonumber(inputBox.Text)
            if input and input >= 1 and input <= 10 then
                speedLevel = input
            else
                speedLevel = 1
                inputBox.Text = "1"
            end
            if conn then conn:Disconnect() end
            conn = RunService.RenderStepped:Connect(function()
                local hum = player.Character and player.Character:FindFirstChild("Humanoid")
                local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if hum and root and hum.MoveDirection.Magnitude > 0 then
                    local moveSpeed = 0
                    if speedLevel == 1 then
                        moveSpeed = 0.02 -- سرعة شبه مخفية جداً جداً بطيئة
                    else
                        moveSpeed = 0.02 + (speedLevel - 2) * 0.02 -- تزيد تدريجياً من 0.02 لـ 0.18 عند 10
                    end
                    root.CFrame = root.CFrame + hum.MoveDirection * moveSpeed
                end
            end)
        else
            if conn then conn:Disconnect() end
        end
    end)

    local btnUp = createButton(texts.up, 230)
    btnUp.MouseButton1Click:Connect(function()
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then hrp.CFrame = hrp.CFrame + Vector3.new(0, 150, 0) end
    end)

    local function isGreenOrHighlight(target)
        for _, part in pairs(target:GetDescendants()) do
            if part:IsA("BasePart") then
                local color = part.Color
                if (color.G > 0.5 and color.R < 0.5 and color.B < 0.5) then
                    return true
                end
            elseif part:IsA("Highlight") then
                local highlightColor = part.FillColor
                if highlightColor.G > 0.5 and highlightColor.R < 0.5 and highlightColor.B < 0.5 then
                    return true
                end
            end
        end
        return false
    end

    local btnEnemy = createButton(texts.tpEnemy, 280)
    btnEnemy.MouseButton1Click:Connect(function()
        local char = player.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        local nearest, dist = nil, math.huge
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChild("Humanoid") then
                local target = p.Character
                if not isGreenOrHighlight(target) and target.Humanoid.Health > 0 then
                    local d = (hrp.Position - target.HumanoidRootPart.Position).Magnitude
                    if d < dist then
                        dist = d
                        nearest = target
                    end
                end
            end
        end

        if nearest then
            local direction = (nearest.HumanoidRootPart.Position - hrp.Position).Unit
            hrp.CFrame = CFrame.new(nearest.HumanoidRootPart.Position - direction * 3, nearest.HumanoidRootPart.Position)
        end
    end)

    local btnClose = Instance.new("TextButton", Frame)
    btnClose.Size = UDim2.new(0, 30, 0, 30)
    btnClose.Position = UDim2.new(1, -35, 0, 5)
    btnClose.Text = texts.close
    btnClose.TextColor3 = Color3.fromRGB(255, 0, 0)
    btnClose.BackgroundTransparency = 1
    btnClose.Font = Enum.Font.GothamBold
    btnClose.TextSize = 20
    btnClose.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
end

arabicBtn.MouseButton1Click:Connect(function()
    startGUI("ar")
end)

englishBtn.MouseButton1Click:Connect(function()
    startGUI("en")
end)
